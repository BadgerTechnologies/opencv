From 82584c7cd285c133d8a8519e0fc73a94ffceefdd Mon Sep 17 00:00:00 2001
From: Nobuhiro Iwamatsu <iwamatsu@nigauri.org>
Date: Tue, 29 Aug 2017 12:27:57 +0900
Subject: [PATCH 1/4] Add support x32

Signed-off-by: Nobuhiro Iwamatsu <iwamatsu@nigauri.org>
---
 CMakeLists.txt                          | 2 ++
 modules/core/src/parallel.cpp           | 4 ++++
 modules/videoio/src/cap_ffmpeg_impl.hpp | 4 ++++
 3 files changed, 10 insertions(+)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index f5a403079d..e5c65297e7 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -574,6 +574,8 @@ if(UNIX)
   if(HAVE_MALLOC_H)
     CHECK_SYMBOL_EXISTS(memalign malloc.h HAVE_MEMALIGN)
   endif()
+
+  CHECK_INCLUDE_FILE(sys/sysctl.h HAVE_SYS_SYSCTL_H)
 endif()
 
 include(cmake/OpenCVPCHSupport.cmake)
diff --git a/modules/core/src/parallel.cpp b/modules/core/src/parallel.cpp
index 0edef5b30e..928418d18e 100644
--- a/modules/core/src/parallel.cpp
+++ b/modules/core/src/parallel.cpp
@@ -60,6 +60,10 @@
         #include <sys/sysconf.h>
     #elif defined __APPLE__ || !defined __GNU__
         #include <sys/sysctl.h>
+    #elif !defined __GNU__
+      #ifdef HAVE_SYS_SYSCTL_H
+         #include <sys/sysctl.h>
+      #endif
     #endif
 #endif
 
diff --git a/modules/videoio/src/cap_ffmpeg_impl.hpp b/modules/videoio/src/cap_ffmpeg_impl.hpp
index 5a9b10f075..c5c57ae223 100644
--- a/modules/videoio/src/cap_ffmpeg_impl.hpp
+++ b/modules/videoio/src/cap_ffmpeg_impl.hpp
@@ -110,6 +110,10 @@ extern "C" {
     #include <sys/sysctl.h>
     #include <mach/clock.h>
     #include <mach/mach.h>
+#elif !defined __GNU__
+    #ifdef HAVE_SYS_SYSCTL_H
+        #include <sys/sysctl.h>
+    #endif
 #endif
 #endif
 
-- 
2.14.1

